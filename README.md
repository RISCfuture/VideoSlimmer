# VideoSlimmer

VideoSlimmer is a tool that removes unneeded audio and subtitle tracks from a 
movie container file using FFMPEG. No transcoding occurs; the tracks to be kept
are simply copied to a new container file without modification.

VideoSlimmer supports removing audio and subtitle tracks that don't match
desired languages, audio codecs, or subtitle codecs.

## Requirements

VideoSlimmer uses both the FFMPEG library and binary. Unfortunately, currently
the application uses the library only for reading and parsing the input file
and determining which tracks to keep; the `ffmpeg` binary is used to actually
perform the conversion. (At some point, I hope to do it all with the library.)

VideoSlimmer currently only works with the macOS operating system. On macOS,
you can install FFMPEG with Homebrew, using `brew install ffmpeg`. FFMPEG
currently compiles only for the x86-64 architecture, and so ARMv7 is not
supported natively.

## Usage

```
USAGE: video-slimmer [--language <language> ...] [--subtitle <subtitle> ...] [--ffmpeg <ffmpeg>] [--no-language <no-language>] <input> <output>

ARGUMENTS:
  <input>                 The video file to slim
  <output>                The output path for the slimmed video file

OPTIONS:
  -l, --language <language>
                          The audio and subtitle track languages to preserve (default: eng)
  -s, --subtitle <subtitle>
                          A subtitle codec to preserve (e.g., subrip) (default: all codecs)
  --ffmpeg <ffmpeg>       Path to ffmpeg executable
  -n, --no-language <no-language>
                          Preserve audio and subtitle tracks with no language metadata (default: false)
  -h, --help              Show help information.
```

The order of languages provided by `--language` determines the order the audio
and subtitle tracks will appear in the output movie, and thus, which language
is chosen by default.

### Video track selection

FFMPEG is capable of working with only one video stream. If a container has
multiple video streams, FFMPEG will automatically select the first one. This is
a limitation of FFMPEG, not VideoSlimmer.

### Audio track selection

Audio tracks whose languages are not included in the `--language` option are
not selected. Of the remaining audio tracks, for each language, one track is
selected by audio codec, with the following priority order:

* Dobly TrueHD
* Dolby DTS
* AC-3
* PCM lossless
* FLAC
* AAC
* MP2
* all others

If there are multiple audio tracks with the same language and audio codec, the
track with the highest channel count is selected.

### Subtitle track selection

Subtitle tracks are chosen based on the `--language` options in the same manner
as audio tracks (see above).

The options provided to `--subtitle` determine which codecs (SubRip, HDMV-PGS)
are chosen. 

## Documentation

DocC documentation can be generated by running:

``` sh
swift package generate-documentation --target VideoSlimmer
```
